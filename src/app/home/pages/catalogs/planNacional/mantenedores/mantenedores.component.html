<!-- BotÃ³n principal: Crear nueva relaciÃ³n Eje - Objetivo -->
<div class="flex justify-between items-center mb-6">
  <button
    class="px-4 py-2 bg-blue-700 text-white font-semibold rounded hover:bg-blue-800 transition"
    (click)="abrirModalRelacion()"
  >
    + Crear nueva relaciÃ³n Eje - Objetivo
  </button>
</div>

<!-- Botones padres para relaciones independientes -->
<div class="flex gap-4 mb-6">
  <button
    class="px-4 py-2 bg-green-700 text-white font-semibold rounded hover:bg-green-800 transition"
    (click)="abrirModalObjetivoMeta()"
  >
    + Relacionar Meta con Objetivo
  </button>

  <button
    class="px-4 py-2 bg-purple-700 text-white font-semibold rounded hover:bg-purple-800 transition"
    (click)="abrirModalObjetivoPolitica()"
  >
    + Relacionar PolÃ­tica con Objetivo
  </button>
</div>

<!-- TÃ­tulo principal -->
<h2 class="text-3xl font-bold text-blue-900 mb-6">Relaciones del Plan Nacional de Desarrollo</h2>

<!-- Lista de relaciones Eje â‡„ Objetivo -->
<div *ngFor="let grupo of ejesAgrupados" class="bg-white rounded-xl shadow-md border border-gray-200 mb-6 p-6">
  <!-- Header de eje -->
  <h3 class="text-xl font-semibold text-blue-900 mb-4">{{ grupo.eje.nombre }}</h3>

  <!-- Objetivos dentro del eje -->
  <div *ngFor="let obj of grupo.objetivos" class="border-l-4 border-blue-500 pl-4 py-4 ml-2 mb-4 bg-gray-50 rounded-md">
    <div class="flex justify-between items-center">
      <p class="font-medium text-gray-800 text-base">ðŸ“Œ {{ obj.nombre }}</p>
      <div class="flex gap-2">
        <!-- BotÃ³n contextual para relacionar Meta -->
        <button
          (click)="abrirModalRelacionMeta(obj.objPnId)"
          class="text-xs bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700"
        >
          + Meta
        </button>

        <!-- BotÃ³n contextual para relacionar PolÃ­tica -->
        <button
          (click)="abrirModalRelacionPolitica(obj.objPnId)"
          class="text-xs bg-purple-600 text-white px-3 py-1 rounded hover:bg-purple-700"
        >
          + PolÃ­tica
        </button>

        <!-- Eliminar relaciÃ³n -->
        <button
          (click)="eliminarRelacionEjeObjetivo(obj.objPnId, grupo.eje.ejePnId)"
          class="text-xs bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700"
        >
          ðŸ—‘ Eliminar RelaciÃ³n
        </button>
      </div>
    </div>

    <!-- Metas -->
    <div class="mt-2 ml-2 text-sm text-green-700" *ngIf="obj.metas.length > 0">
      <p class="font-semibold">ðŸŽ¯ Metas:</p>
      <ul class="list-disc ml-5">
        <li *ngFor="let meta of obj.metas" class="text-gray-700">{{ meta.nombre }}</li>
      </ul>
    </div>

    <!-- PolÃ­ticas -->
    <div class="mt-2 ml-2 text-sm text-purple-700" *ngIf="obj.politicas.length > 0">
      <p class="font-semibold">ðŸ“˜ PolÃ­ticas:</p>
      <ul class="list-disc ml-5">
        <li *ngFor="let poli of obj.politicas" class="text-gray-700">{{ poli.nombre }}</li>
      </ul>
    </div>
  </div>
</div>

<!-- Modales existentes -->
<app-add-eje-objetivo-modal
  [visible]="modalRelacionVisible"
  (closed)="modalRelacionVisible = false"
  (relacionCreada)="crearRelacionEjeObjetivo($event)"
></app-add-eje-objetivo-modal>

<app-add-objetivo-modal
  [visible]="modalVisible"
  (closed)="cerrarModal()"
  (objetivoCreado)="agregarObjetivo($event)"
></app-add-objetivo-modal>

<app-add-objetivo-meta-modal
  [visible]="modalObjetivoMetaVisible"
  (closed)="modalObjetivoMetaVisible = false"
  (relacionCreada)="crearRelacionObjetivoMeta($event)"
></app-add-objetivo-meta-modal>

<app-add-objetivo-politica-modal
  [visible]="modalObjetivoPoliticaVisible"
  (closed)="modalObjetivoPoliticaVisible = false"
  (relacionCreada)="crearRelacionObjetivoPolitica($event)"
></app-add-objetivo-politica-modal>

<!-- ðŸ”¥ Nuevos modales dinÃ¡micos con objPnId -->
<app-add-meta-to-objetivo-modal
  [visible]="modalMetaVisible"
  [objPnId]="selectedObjPnId!"
  (closed)="modalMetaVisible = false"
  (relacionCreada)="actualizarRelaciones()"
></app-add-meta-to-objetivo-modal>

<app-add-politica-to-objetivo-modal
  [visible]="modalPoliticaVisible"
  [objPnId]="selectedObjPnId!"
  (closed)="modalPoliticaVisible = false"
  (relacionCreada)="actualizarRelaciones()"
></app-add-politica-to-objetivo-modal>
